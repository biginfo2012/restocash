<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Content-Security-Policy"
          content="default-src * data: gap: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <!-- Global stylesheets -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/atlantis.min.css" rel="stylesheet">
    <link href="assets/css/fonts.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/spinners.css">

    <!-- custom stylesheets -->
    <link href="custom/css/style.css" rel="stylesheet">
    <style>
        .table-box {
            cursor: pointer;
        }

        #order-list td {
            height: 55px;
        }

        .quantity {
            display: flex;
        }

        @media (min-width: 768px) {
            .modal-lg {
                max-width: 650px;
            }
        }

        @media (min-width: 992px) {
            .modal-lg {
                max-width: 900px;
            }
        }

        @media (min-width: 1200px) {
            .modal-lg {
                max-width: 1000px;
            }
        }
    </style>
    <!-- Core JS files -->
    <script src="assets/js/core/jquery.3.2.1.min.js"></script>
    <script src="assets/js/core/popper.min.js"></script>
    <script src="assets/js/core/bootstrap.min.js"></script>
    <!-- /core JS files -->

    <script src="assets/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <script src="assets/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>
    <script src="assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
    <script src="assets/js/plugin/jquery.validate/jquery.validate.min.js"></script>
    <script src="assets/js/atlantis.min.js"></script>
    <script src="assets/js/plugin/sweetalert/sweetalert.min.js"></script>
    <script src="assets/js/spinner.js"></script>

    <script src="custom/lang/converter.js?v=202112061555"></script>
    <script src="custom/lang/es.js?v=202112061555"></script>
</head>
<body>
<div class="preloader" style="display: none">
    <svg class="circular" viewBox="25 25 50 50">
        <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/>
    </svg>
</div>
<div class="wrapper">

    <!-- Main navbar -->
    <div class="main-header">
        <!-- Logo Header -->
        <div class="logo-header" data-background-color="dark">

            <a class="logo text-center text-white d-flex" style="left: 20%">
                <img src="assets/img/logo.png" alt="navbar brand" class="navbar-brand"
                     style="width: 50px;">
                <span class="pt-1">RestoCash</span>
            </a>
            <button class="topbar-toggler more"><i class="icon-options-vertical"></i></button>
            <div class="nav-toggle">
                <button class="btn btn-toggle toggle-sidebar">
                    <i class="icon-menu"></i>
                </button>
            </div>
        </div>
        <!-- End Logo Header -->

        <!-- Navbar Header -->
        <nav class="navbar navbar-header navbar-expand-lg" data-background-color="white">
            <div class="container-fluid d-flex justify-content-between">
                <ul class="navbar-nav topbar-nav ml-md-auto align-items-center">
                    <li class="nav-item dropdown hidden-caret">
                        <a class="nav-link" href="qr.html">
                            <i class="fa fa-qrcode"></i>
                        </a>
                    </li>
                    <li class="nav-item dropdown hidden-caret">
                        <a class="nav-link dropdown-toggle" href="">
                            <i class="fa fa-th"></i>
                        </a>
                    </li>
                    <li class="nav-item dropdown hidden-caret">
                        <a class="nav-link dropdown-toggle" id="logout" style="margin-left: 10px" href="#">
                            <i class="fa fa-power-off"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <!-- End Navbar -->
    </div>
    <!-- /Main navbar -->

    <!-- Page content -->
    <div class="page-content">
        <!-- Main content -->
        <div class="main-panel">
            <!-- Content area -->
            <div class="container">
                <div class="page-inner">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header d-flex align-items-center justify-content-between">
                                    <h4 class="card-title">Mesas</h4>
                                </div>
                                <div class="card-body">
                                    <h3 id="no_table" class="text-danger text-center">No Mesas</h3>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="table-group" id="table_group">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="optionModal" tabindex="-1" role="dialog" aria-labelledby="optionModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title" id="optionModalLabel">Seleccionar tipo de orden</h2>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-check">
                                <label class="form-radio-label">
                                    <input class="form-radio-input" type="radio" name="orderType" value="0" checked>
                                    <span class="form-radio-sign">Nuevo orden</span>
                                </label>
                                <label class="form-radio-label ml-3">
                                    <input class="form-radio-input" type="radio" name="orderType" value="1">
                                    <span class="form-radio-sign">Orden existente</span>
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-black btn-round btn-next">Próximo</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="existingModal" tabindex="-1" role="dialog" aria-labelledby="existingModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title" id="existingModalLabel">Seleccionar ordens</h3>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="order-list">

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-black btn-round btn-assign">Salvar</button>
                            <button type="button" class="btn btn-round" data-dismiss="modal">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="detailModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title" id="detailModalLabel">Detalle</h1>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="detail">
                            <div class="row">
                                <div class="col-12 col-md-4">
                                    <div class="bg-light px-2 py-3">
                                        <div class="bg-black text-white px-3 py-1 mb-3">
                                            <h3 class="mb-0 text-center">Lista de pedidos</h3>
                                        </div>
                                        <div id="assigned-orders">

                                        </div>
                                        <div class="mt-3">
                                            <h1 class="text-right">Total : <span id="detail-total"></span></h1>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-md-8">
                                    <div class="bg-grey2 px-2 py-3">
                                        <div class="bg-black text-white px-3 py-1 mb-3">
                                            <h3 class="mb-0 text-center">Agregar nuevo pedido</h3>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="table-responsive">
                                                    <table class="table table-striped" id="dt_table">
                                                        <thead>
                                                        <tr>
                                                            <th>Contar</th>
                                                            <th>Nombre</th>
                                                            <th>Precio venta</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody id="product_tbody">

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label for="comment">Comentario</label>
                                                    <textarea class="form-control" id="comment"
                                                              name="comment"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-12 d-flex align-items-center justify-content-between mt-2">
                                                <h2 class="mb-0 ml-3">Total : <span id="new-total">0</span>
                                                </h2>
                                                <button type="button" class="btn btn-black btn-round btn-order">
                                                    Agregar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
<!--                            <button type="button" class="btn btn-black btn-round btn-print">Impresión</button>-->
                            <button type="button" class="btn btn-danger btn-round btn-pend">Cerrar mesa
                            </button>
                            <button type="button" class="btn btn-round" data-dismiss="modal">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="qrModal" tabindex="-1" role="dialog" aria-labelledby="qrModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title" id="qrModalLabel">Seleccionar ordens</h3>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="qr_image">
                            <div class="row">
                                <div class="col-12">
                                    <div id="qrcode"></div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-round" data-dismiss="modal">Confirmar</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /content area -->

        </div>
        <!-- /main content -->
    </div>
</div>
<!-- Datatable JS -->
<script src="assets/js/plugin/datatables/datatables.min.js"></script>
<script src="assets/js/plugin/qrcode/qrcode.js"></script>
<script>
    let token = localStorage.getItem('token');
    let tables = 'https://dev-restaurant.pagocash.cl/api/tables'
    $(document).ready(function () {
        $.ajax({
            url: tables,
            type: 'post',
            contentType: 'application/json',
            headers: {
                'Authorization': 'Bearer ' + token
            },
            success: function (response) {
                // CallBack(result);
                if(response.message == "success"){
                    let tables = response.result.tables;
                    if(tables.length > 0){
                        $('#no_table').remove();
                        for(let i = 0; i < tables.length; i++){
                            let item = tables[i];
                            let table_id = item['id'];
                            let status = item['status'];
                            let class_str, title;
                            if(status == 'open'){
                                class_str = 'bg-success-gradient success-shadow';
                                title = 'Abierto'
                            }
                            else if(status == 'ordered'){
                                class_str = 'bg-warning-gradient';
                                title = 'Ordenado'
                            }
                            else if(status == 'pend'){
                                class_str = 'bg-danger-gradient';
                                title = 'Provisional cerrado'
                            }
                            else if(status == 'ordered'){
                                class_str = 'bg-black';
                                title = 'Disponible'
                            }
                            else{
                                class_str = '';
                                title = ''
                            }
                            let table_content = '<div class="table-box" data-index="' +  item["id"]+ '">\n' +
                                '                                                    <div class="table-status '+ class_str +'" title="'+ title +'"></div>\n' +
                                '                                                    <h6 class="text-center mb-0">Mesa-' +  item["t_number"]+ '</h6>\n' +
                                '                                                    <h5 class="text-center">' +  item["name"]+ '</h5>\n' +
                                '                                                </div>';
                            $('#table_group').prepend(table_content);
                        }
                    }
                    let products = response.result.products;
                    if(products.length > 0){
                        for(let i = 0; i < products.length; i++){
                            let img_url;
                            let item = products[i];
                            if(item['image'] == null){
                                img_url = 'no_product'
                            }
                            else{
                                img_url = item['image'];
                            }
                            let price = item['sale_price'];
                            price = parseInt(price)
                            let product_content = '<tr>\n' +
                                '                                                        <td>\n' +
                                '                                                            <div class="quantity">\n' +
                                '                                                                <button class="minus-btn" type="button" name="button">-</button>\n' +
                                '                                                                <input type="text" class="order_count" name="order_count_' + item['id'] + '" data-value="' + item['id'] + '" data-price="' + item['sale_price'] + '" value="0" min="0">\n' +
                                '                                                                <button class="plus-btn" type="button" name="button">+</button>\n' +
                                '                                                            </div>\n' +
                                '                                                        </td>\n' +
                                '                                                        <td>' + item["name"] + '</td>\n' +
                                '                                                        <td>' + price + '</td>\n' +
                                '                                                    </tr>';
                            $('#product_tbody').prepend(product_content);
                        }
                        $('#dt_table').DataTable({
                            "pageLength": 10,
                            "lengthChange": false,
                            "order": [[ 1, 'asc' ]],
                            "aoColumnDefs": [
                                { 'bSortable': false, 'aTargets': [ 0, 3 ] }
                            ]
                        });
                    }

                }

            },
            error: function (error) {

            }
        });
    })
    let logout_url = 'https://dev-restaurant.pagocash.cl/api/logout'
    $('#logout').click(function () {
        $.ajax({
            url: logout_url,
            type: 'post',
            contentType: 'application/json',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('token')
            },
            success: function(response){
                if(response.message == 'logout'){
                    window.location.href = 'index.html';
                }else{
                    console.log('error');
                    window.location.href = 'index.html';
                }
            },
        });
    })
</script>
<script src="custom/js/waiter/table-list.js?v=202112181555"></script>
<!-- TODO: Please edit here -->
</body>
</html>
